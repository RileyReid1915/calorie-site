<div id="calorie-widget" style="width: 100%; max-width: 600px; margin: 20px auto;">
  <h2>Калькулятор Калорій</h2>
  <form id="calorie-form">
    <input type="number" id="weight" placeholder="Вага (кг)" required>
    <input type="number" id="height" placeholder="Зріст (см)" required>
    <input type="number" id="age" placeholder="Вік" required>
    <select id="gender">
      <option value="male">Чоловік</option>
      <option value="female">Жінка</option>
    </select>
    <button type="submit">Розрахувати</button>
  </form>
  <p id="result"></p>
  <div id="3d-container" style="width: 100%; height: 300px; margin-top: 20px;"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    (function() {
      // Налаштування Three.js
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(75, 600 / 300, 0.1, 1000);
      const renderer = new THREE.WebGLRenderer();
      renderer.setSize(600, 300);
      document.getElementById('3d-container').appendChild(renderer.domElement);

      // Створення куба як тіла
      const geometry = new THREE.BoxGeometry(1, 2, 1);
      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
      const body = new THREE.Mesh(geometry, material);
      scene.add(body);
      camera.position.z = 5;

      function animate() {
        requestAnimationFrame(animate);
        body.rotation.y += 0.01; // Обертання моделі
        renderer.render(scene, camera);
      }
      animate();

      // Оновлення розміру моделі на основі введених даних
      function updateBody(weight, height) {
        body.scale.set(weight / 50, height / 150, 1);
      }

      // Запит до API та оновлення моделі
      document.getElementById('calorie-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);
        const age = parseInt(document.getElementById('age').value);
        const gender = document.getElementById('gender').value;

        try {
          const response = await fetch('https://calorie-api-n8u8.onrender.com/api/calculate-calories', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ weight, height, age, gender })
          });

          if (!response.ok) throw new Error('Помилка при запиті до API');

          const data = await response.json();
          document.getElementById('result').innerText = `Добова норма калорій: ${data.daily_calories} ккал`;

          updateBody(weight, height); // Оновлення моделі
        } catch (error) {
          document.getElementById('result').innerText = 'Сталася помилка: ' + error.message;
        }
      });
    })();
  </script>
</div>

